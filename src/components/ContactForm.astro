---
interface Props {
  contactListName?: string;
  successMessage?: string;
  errorMessage?: string;
}

const {
  contactListName = 'evene_contact',
  successMessage = 'Gracias por tu mensaje! Nos pondremos en contacto contigo lo antes posible.',
  errorMessage = 'Ha ocurrido un error al enviar el mensaje. Por favor, inténtalo de nuevo.',
} = Astro.props;
---

<div class="bg-white rounded-lg shadow-lg p-8">
  <form id="contact-form" class="space-y-6" data-contact-list={contactListName}>
    <div>
      <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Nombre</label>
      <input
        type="text"
        id="name"
        name="name"
        required
        class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        placeholder="Tu nombre"
      />
    </div>

    <div>
      <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Correo electrónico</label>
      <input
        type="email"
        id="email"
        name="email"
        required
        class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        placeholder="tu@correo.com"
      />
    </div>

    <div>
      <label for="message" class="block text-sm font-medium text-gray-700 mb-1">Mensaje</label>
      <textarea
        id="message"
        name="message"
        rows="5"
        required
        class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        placeholder="¿En qué podemos ayudarte?"></textarea>
    </div>

    <div>
      <button type="submit" class="cta-gradient w-full">Enviar mensaje</button>
    </div>

    <div id="form-status" class="text-center hidden">
      <p id="success-message" class="text-green-600 hidden">
        {successMessage}
      </p>
      <p id="error-message" class="text-red-600 hidden">
        {errorMessage}
      </p>
    </div>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const formStatus = document.getElementById('form-status');
    const successMessage = document.getElementById('success-message');
    const errorMessage = document.getElementById('error-message');

    if (form && formStatus && successMessage && errorMessage) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = new FormData(form);
        const data = {
          contact_list_name: form.dataset.contactList,
          name: formData.get('name'),
          email: formData.get('email'),
          message: formData.get('message'),
        };

        console.log('Data', data);

        try {
          const response = await fetch('https://waitlist.hlab.es/contact/messages/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
          });

          formStatus.classList.remove('hidden');

          if (response.ok) {
            successMessage.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            form.reset();
          } else {
            errorMessage.classList.remove('hidden');
            successMessage.classList.add('hidden');

            const errorText = await response.text().catch(() => 'No response text');
            console.error('Error submitting form:', {
              status: response.status,
              statusText: response.statusText,
              responseText: errorText,
            });
          }
        } catch (error) {
          formStatus.classList.remove('hidden');
          errorMessage.classList.remove('hidden');
          successMessage.classList.add('hidden');
          console.error('Error submitting form:', error);
        }
      });
    }
  });
</script>

